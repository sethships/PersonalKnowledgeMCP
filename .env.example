# Personal Knowledge MCP - Environment Configuration Template (Phase 1)
# Copy this file to .env and fill in your actual values

# ============================================================================
# Required: OpenAI API Key for Embedding Generation
# ============================================================================
# Get your API key from: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-your-api-key-here

# ============================================================================
# Optional: GitHub Personal Access Token (for private repositories)
# ============================================================================
# Create a PAT at: https://github.com/settings/tokens
# Required scopes: repo (for private repos)
GITHUB_PAT=ghp_your-token-here

# ============================================================================
# ChromaDB Connection (defaults work with docker-compose)
# ============================================================================
# ChromaDB host - defaults to localhost (container binds to 127.0.0.1 only for security)
CHROMADB_HOST=localhost
CHROMADB_PORT=8000

# ============================================================================
# ChromaDB Authentication Token (production security)
# ============================================================================
# Optional: Authentication token for ChromaDB server
# When set, both the server (docker-compose) and client will require this token
# Leave empty for unauthenticated access (development only)
#
# Generate a secure token with:
#   openssl rand -hex 32
#
# Token rotation: Generate new token, update here, restart docker-compose and MCP service
# CHROMADB_AUTH_TOKEN=your-secure-token-here

# ============================================================================
# PostgreSQL Configuration (Phase 2 - Document Store)
# ============================================================================
# PostgreSQL database credentials for the document store
# Generate a secure password with: openssl rand -base64 32
#
# IMPORTANT: POSTGRES_PASSWORD is required - container will not start without it
POSTGRES_USER=pk_mcp
POSTGRES_PASSWORD=changeme-use-secure-password
POSTGRES_DB=personal_knowledge

# Connection settings (for future application use)
POSTGRES_HOST=localhost
POSTGRES_PORT=5432

# ============================================================================
# ChromaDB Container Settings (docker-compose.yml overrides)
# ============================================================================
# These settings can override defaults in docker-compose.yml when set in .env
#
# CHROMADB_ALLOW_RESET: Override ALLOW_RESET in docker-compose.yml
# - Set to TRUE for development (enables reset endpoint)
# - Default is FALSE for production safety
# WARNING: Setting to TRUE enables the reset endpoint which deletes ALL data
CHROMADB_ALLOW_RESET=FALSE
#
# Reference: The following are hardcoded in docker-compose.yml (not overridable):
# - IS_PERSISTENT=TRUE (data persistence enabled)
# - ANONYMIZED_TELEMETRY=FALSE (telemetry disabled)

# ============================================================================
# Data Paths
# ============================================================================
# Directory where repositories will be cloned
REPO_CLONE_PATH=./data/repos

# Base data directory for all persistent data
DATA_PATH=./data

# ============================================================================
# Logging Configuration
# ============================================================================
# Log level: trace, debug, info, warn, error, fatal
LOG_LEVEL=info

# Log format: json or pretty (use pretty for development)
LOG_FORMAT=pretty

# ============================================================================
# Embedding Configuration
# ============================================================================
# OpenAI embedding model (Phase 1 supports text-embedding-3-small only)
EMBEDDING_MODEL=text-embedding-3-small

# Embedding dimensions (1536 for text-embedding-3-small)
EMBEDDING_DIMENSIONS=1536

# ============================================================================
# Chunking Configuration
# ============================================================================
# Maximum tokens per chunk (affects embedding quality vs. granularity)
CHUNK_MAX_TOKENS=500

# Token overlap between consecutive chunks (for context continuity)
CHUNK_OVERLAP_TOKENS=50

# ============================================================================
# File Scanning Configuration
# ============================================================================
# Supported file extensions for indexing (comma-separated, no spaces)
SUPPORTED_EXTENSIONS=.js,.ts,.jsx,.tsx,.cs,.py,.java,.go,.rs,.cpp,.c,.h,.md,.txt,.rst,.json,.yaml,.yml,.toml

# Maximum file size to process (in bytes, 1MB = 1048576)
MAX_FILE_SIZE_BYTES=1048576

# ============================================================================
# Search Configuration
# ============================================================================
# Default number of search results
DEFAULT_SEARCH_LIMIT=10

# Maximum allowed search results
MAX_SEARCH_LIMIT=50

# Default similarity threshold (0.0 to 1.0)
DEFAULT_SIMILARITY_THRESHOLD=0.7

# Maximum length of content snippets in search results (characters)
SNIPPET_MAX_LENGTH=500

# ============================================================================
# Performance Configuration
# ============================================================================
# Maximum batch size for OpenAI embedding API calls (OpenAI limit is 100)
EMBEDDING_BATCH_SIZE=100

# Maximum retries for transient API failures
MAX_RETRIES=3

# Request timeout in milliseconds
REQUEST_TIMEOUT_MS=30000

# Initial delay before first retry (in milliseconds)
RETRY_INITIAL_DELAY_MS=1000

# Maximum delay between retries (caps exponential growth, in milliseconds)
RETRY_MAX_DELAY_MS=60000

# Backoff multiplier for exponential delay growth (e.g., 2 = delays double each retry)
RETRY_BACKOFF_MULTIPLIER=2

# ============================================================================
# Development/Debug Settings
# ============================================================================
# Enable debug mode (more verbose logging)
DEBUG=false

# Node environment (development, production, test)
NODE_ENV=development

# ============================================================================
# Update History Configuration
# ============================================================================
# Maximum number of update history entries to retain per repository
# Older entries are automatically rotated out when limit is exceeded
UPDATE_HISTORY_LIMIT=20

# ============================================================================
# HTTP Transport Configuration (Phase 3 - Multi-Transport Support)
# ============================================================================
# Enable HTTP/SSE transport in addition to stdio (for Cursor, VS Code, etc.)
# Default: false (stdio-only for Claude Code compatibility)
HTTP_TRANSPORT_ENABLED=false

# HTTP server port (default 3001, 3000 typically used for dev servers)
HTTP_PORT=3001

# HTTP server host (default 127.0.0.1 for security)
# Use 0.0.0.0 for network access (not recommended without authentication)
HTTP_HOST=127.0.0.1

# Maximum concurrent SSE sessions (prevent resource exhaustion)
# Default: 100
HTTP_MAX_SSE_SESSIONS=100

# SSE session TTL in milliseconds (sessions idle beyond this are cleaned up)
# Default: 1800000 (30 minutes)
HTTP_SSE_SESSION_TTL_MS=1800000

# Stale session cleanup interval in milliseconds
# Default: 300000 (5 minutes)
HTTP_SSE_CLEANUP_INTERVAL_MS=300000
